<!DOCTYPE html> 
<html lang="es"> 
<head> 
    <meta charset="UTF-8"> 
    <title>Prueba Braille</title> 
    <style> 
        body { font-family: Arial, sans-serif; padding: 1rem; } 
        select, input, button { margin: 0.5rem 0; padding: 0.5rem; } 
        .cell-container { display: flex; gap: 1rem; margin-top: 1rem; } 
        .braille-cell { 
            display: grid; 
            grid-template-columns: repeat(2, 20px); 
            grid-template-rows: repeat(3, 20px); 
            gap: 5px; 
            width: fit-content; 
        } 
        .dot { 
            width: 20px; 
            height: 20px; 
            border-radius: 50%; 
            background-color: lightgray; 
        } 
        .filled { background-color: black; } 
    </style> 
</head> 
<body> 
 
<h2>Lecturas Braille Disponibles</h2> 
 
<label for="fileSelect">Selecciona un archivo:</label> 
<select id="fileSelect"></select> 
 
<br> 
 
<label for="chunkInput">Cantidad de caracteres a leer (chunk_size):</label> 
<input type="number" id="chunkInput" min="1" value="3"> 
 
<button onclick="leerBraille()">Leer</button> 
 
<div id="brailleOutput" class="cell-container"></div> 
 
<script> 
    const token = localStorage.getItem('token')
    if (!token) {
        alert('No autorizado');
        window.location.href = '/';
    }

    // Cargar archivos al cargar la pÃ¡gina 
    window.onload = async () => { 
        const response = await fetch('/api/braille/files',
            {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            }
        ); 

        const data = await response.json(); 
        const archivos = data.files;
        const select = document.getElementById('fileSelect');
        
        console.log(archivos)
 
        archivos.forEach(file => { 
            const option = document.createElement('option'); 
            option.value = file; 
            option.textContent = file; 
            select.appendChild(option); 
        }); 
    }; 
 
    async function leerBraille() { 
        const title = document.getElementById('fileSelect').value; 
        const chunk_size = parseInt(document.getElementById('chunkInput').value); 
 
        const res = await fetch('/api/braille/read', { 
            method: 'POST', 
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            }, 
            body: JSON.stringify({ title, chunk_size }) 
        }); 
 
        const data = await res.json(); 
        console.log("Respuesta:", data); 
 
        const container = document.getElementById('brailleOutput'); 
        container.innerHTML = ''; 
 
        data.chunk.forEach(bits => { 
            const cell = document.createElement('div'); 
            cell.className = 'braille-cell'; 
 
            for (let i = 0; i < 6; i++) { 
                const dot = document.createElement('div'); 
                dot.className = 'dot'; 
                if (bits[i] === '1') dot.classList.add('filled'); 
                cell.appendChild(dot); 
            } 
 
            container.appendChild(cell); 
        }); 
    } 
</script> 
 
</body> 
</html> 